!function(e){"use strict";var t={};function i(e){var t=parseFloat(e).toFixed(lifeTravel.decimals),i=(t=t.replace(".",lifeTravel.decimal_separator)).split(lifeTravel.decimal_separator);return i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,lifeTravel.thousand_separator),t=i.join(lifeTravel.decimal_separator),lifeTravel.price_format.replace("%1$s",lifeTravel.currency_symbol).replace("%2$s",t)}e(document).ready((function(){!function(){var a=e(".life-travel-excursion-form");if(a.length){var s=a.find('input[name="participants"]'),r=a.find('input[name="start_date"]'),n=a.find('input[name="end_date"]'),l=a.find('input[name^="extras"]'),c=a.find('input[name^="activities"]'),d=a.find('input[name="product_id"]'),o=e(".price-breakdown");a.on("change","input, select",(function(){p()})),p()}function p(){var i=d.val(),a=parseInt(s.val())||1,p=r.val(),h=n.val(),u=[];l.filter(":checked").each((function(){u.push(e(this).val())}));var f=[];c.filter(":checked").each((function(){f.push(e(this).val())}));var _=[i,a,p,h,u.join(","),f.join(",")].join("|");t[_]?v(t[_]):(o.html('<div class="loading-spinner">Calcul en cours...</div>'),e.ajax({url:lifeTravel.ajax_url,type:"POST",data:{action:"life_travel_excursion_calculate_price",product_id:i,participants:a,start_date:p,end_date:h,extras:u,activities:f,security:lifeTravel.nonce},success:function(e){e.success?(t[_]=e.data,v(e.data)):o.html('<p class="error">'+e.data+"</p>")},error:function(){o.html('<p class="error">Erreur lors du calcul du prix. Veuillez réessayer.</p>')}}))}function v(t){if(lifeTravel.is_mobile){var a="<h4>Détail du prix</h4>";a+='<div class="price-mobile-breakdown">',a+='<div class="base-price-row"><span>Base</span><span>'+i(t.base_price)+"</span></div>",t.extras_price>0&&(a+='<div class="extras-price-row"><span>Extras</span><span>'+i(t.extras_price)+"</span></div>"),t.activities_price>0&&(a+='<div class="activities-price-row"><span>Activités</span><span>'+i(t.activities_price)+"</span></div>"),t.vehicles_needed>1&&(a+='<div class="vehicle-price-row"><span>Véhicules ('+t.vehicles_needed+")</span><span>"+i(t.vehicle_price)+"</span></div>"),a+='<div class="price-total-row"><span>Total</span><span>'+i(t.total_price)+"</span></div>",a+="</div>",o.html(a)}else{if(a="<h4>Détail du prix</h4>",a+="<table>",a+="<tr><th>Élément</th><th>Détails</th><th>Prix</th></tr>",a+="<tr>",a+="<td>Prix de base</td>",a+="<td>"+t.participants+" personne(s) × "+i(t.price_per_person)+"</td>",a+="<td>"+i(t.base_price)+"</td>",a+="</tr>",t.extras_price>0&&t.extras_details.length>0)for(var s=0;s<t.extras_details.length;s++){var r=t.extras_details[s];a+="<tr>",a+="<td>Extra: "+r.name+"</td>",a+="<td>"+r.quantity+" × "+i(r.price)+"</td>",a+="<td>"+i(r.total)+"</td>",a+="</tr>"}if(t.activities_price>0&&t.activities_details.length>0)for(s=0;s<t.activities_details.length;s++){var n=t.activities_details[s];a+="<tr>",a+="<td>Activité: "+n.name+"</td>",a+="<td>"+n.quantity+" × "+i(n.price)+"</td>",a+="<td>"+i(n.total)+"</td>",a+="</tr>"}t.vehicles_needed>0&&(a+="<tr>",a+="<td>Véhicules</td>",a+="<td>"+t.vehicles_needed+" véhicule(s)</td>",a+="<td>"+i(t.vehicle_price)+"</td>",a+="</tr>"),a+="</table>",a+='<div class="price-total">Total: '+i(t.total_price)+"</div>",o.html(a)}!function(t){var i=e(".vehicle-options");if(i.length)if(t>1){var a='<div class="vehicle-info">';a+='<svg class="vehicle-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3h9l3 4.5v9.5h-2m-10 0h-6v-9.5l3-4.5h3m6 4h-8M3 9h4M17 9h4M3 13h18M5 17h2M17 17h2M5 12v3.5M19 12v3.5M8 12v3.5M16 12v3.5M12 12v3.5"/></svg>',a+="<span>"+t+" véhicules seront nécessaires pour cette excursion.</span>",a+="</div>",a+='<p class="vehicle-note">Le coût des véhicules supplémentaires est inclus dans le prix total.</p>',i.html(a).show()}else a='<div class="vehicle-info">',a+='<svg class="vehicle-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3h9l3 4.5v9.5h-2m-10 0h-6v-9.5l3-4.5h3m6 4h-8M3 9h4M17 9h4M3 13h18M5 17h2M17 17h2M5 12v3.5M19 12v3.5M8 12v3.5M16 12v3.5M12 12v3.5"/></svg>',a+="<span>Un véhicule standard est inclus.</span>",a+="</div>",i.html(a).show()}(t.vehicles_needed)}}(),e(".extra-item").on("click",(function(t){if("checkbox"!==t.target.type){var i=e(this).find('input[type="checkbox"]');i.prop("checked",!i.prop("checked")).trigger("change")}})),e(".payment-method-item").on("click",(function(){e(".payment-method-item").removeClass("selected"),e(this).addClass("selected"),e(this).find('input[type="radio"]').prop("checked",!0)})),lifeTravel.is_mobile&&(e(".extras-grid").addClass("mobile-view"),e(".price-breakdown").addClass("mobile-view"),e("input, select").addClass("mobile-input"),e("table").addClass("mobile-table")),function(){var t=e(".lte-search");if(t.length){var i,a=t.find("input[type=search]"),s=t.find(".lte-search-results");a.on("input",(function(){clearTimeout(i);var t=e(this).val();t.length<2?s.empty():i=setTimeout((function(){e.get(LTE_Search.ajax_url,{action:"lte_search_suggestions",term:t,nonce:LTE_Search.nonce},(function(t){s.empty(),t.forEach((function(t){var i=e('<div class="lte-suggestion"><a href="'+t.link+'"><img src="'+t.thumb+'" /><span>'+t.title+"</span></a></div>");s.append(i)}))}))}),300)}))}}(),e(".lte-vote").each((function(){var t=e(this),i=t.data("product-id");t.find(".lte-vote-button").on("click",(function(){e(this).prop("disabled",!0),e.post(LTE_Vote.ajax_url,{action:"lte_vote_submit",product_id:i,nonce:LTE_Vote.nonce},(function(a){a.success?e.get(LTE_Vote.ajax_url,{action:"lte_vote_results",product_id:i},(function(e){t.find(".lte-vote-results").text(e+" votes")})):alert(a.data.message||"Error")}))}))}))}))}(jQuery);