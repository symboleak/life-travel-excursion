/*! For license information please see service-worker.bundle.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){"use strict";t=function(){return n};var r,n={},a=Object.prototype,o=a.hasOwnProperty,c=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},i=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(r){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,o=Object.create(a.prototype),s=new O(n||[]);return c(o,"_invoke",{value:T(e,r,s)}),o}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}n.wrap=f;var d="suspendedStart",v="suspendedYield",m="executing",y="completed",x={};function g(){}function b(){}function w(){}var k={};p(k,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(q([])));E&&E!==a&&o.call(E,i)&&(k=E);var S=w.prototype=g.prototype=Object.create(k);function A(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function L(t,r){function n(a,c,s,i){var u=h(t[a],t,c);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==e(p)&&o.call(p,"__await")?r.resolve(p.__await).then((function(e){n("next",e,s,i)}),(function(e){n("throw",e,s,i)})):r.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,i)}))}i(u.arg)}var a;c(this,"_invoke",{value:function(e,t){function o(){return new r((function(r,a){n(e,t,r,a)}))}return a=a?a.then(o,o):o()}})}function T(e,t,n){var a=d;return function(o,c){if(a===m)throw Error("Generator is already running");if(a===y){if("throw"===o)throw c;return{value:r,done:!0}}for(n.method=o,n.arg=c;;){var s=n.delegate;if(s){var i=j(s,n);if(i){if(i===x)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===d)throw a=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=m;var u=h(e,t,n);if("normal"===u.type){if(a=n.done?y:v,u.arg===x)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=y,n.method="throw",n.arg=u.arg)}}}function j(e,t){var n=t.method,a=e.iterator[n];if(a===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=r,j(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),x;var o=h(a,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,x;var c=o.arg;return c?c.done?(t[e.resultName]=c.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,x):c:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,x)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function q(t){if(t||""===t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,c=function e(){for(;++a<t.length;)if(o.call(t,a))return e.value=t[a],e.done=!1,e;return e.value=r,e.done=!0,e};return c.next=c}}throw new TypeError(e(t)+" is not iterable")}return b.prototype=w,c(S,"constructor",{value:w,configurable:!0}),c(w,"constructor",{value:b,configurable:!0}),b.displayName=p(w,l,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,p(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},n.awrap=function(e){return{__await:e}},A(L.prototype),p(L.prototype,u,(function(){return this})),n.AsyncIterator=L,n.async=function(e,t,r,a,o){void 0===o&&(o=Promise);var c=new L(f(e,t,r,a),o);return n.isGeneratorFunction(t)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},A(S),p(S,l,"Generator"),p(S,i,(function(){return this})),p(S,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},n.values=q,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(N),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,a){return s.type="throw",s.arg=e,t.next=n,a&&(t.method="next",t.arg=r),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a],s=c.completion;if("root"===c.tryLoc)return n("end");if(c.tryLoc<=this.prev){var i=o.call(c,"catchLoc"),u=o.call(c,"finallyLoc");if(i&&u){if(this.prev<c.catchLoc)return n(c.catchLoc,!0);if(this.prev<c.finallyLoc)return n(c.finallyLoc)}else if(i){if(this.prev<c.catchLoc)return n(c.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return n(c.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var c=a?a.completion:{};return c.type=e,c.arg=t,a?(this.method="next",this.next=a.finallyLoc,x):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),x},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),N(r),x}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;N(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:q(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),x}},n}function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,s=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){i=!0,c=e},f:function(){try{s||null==r.return||r.return()}finally{if(i)throw c}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t,r,n,a,o,c){try{var s=e[o](c),i=s.value}catch(e){return void r(e)}s.done?t(i):Promise.resolve(i).then(n,a)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var c=e.apply(t,r);function s(e){a(c,n,o,s,i,"next",e)}function i(e){a(c,n,o,s,i,"throw",e)}s(void 0)}))}}var c="/offline.html",s="life-travel-api-cache-v1",i="life-travel-static-cache-v1",u="cache-first",l="network-first",p="stale-while-revalidate",f=[{pattern:/\.(?:css|js|woff2|woff|ttf|svg|png|jpg|jpeg|gif|webp|ico)$/i,strategy:u,cacheName:i,maxAgeSeconds:2592e3},{pattern:/\/wp-json\/|\/admin-ajax\.php/i,strategy:p,cacheName:s,maxAgeSeconds:86400}],h=[c,"/assets/css/life-travel-excursion.css","/assets/js/life-travel-excursion-frontend.js","/assets/js/price-calculator.js","/assets/img/momo-icon.png","/assets/img/card-icon.png"];function d(){return(d=o(t().mark((function e(){var n,a,o,c,i,u,l,p,f,h;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,caches.open(s);case 2:return n=e.sent,e.next=5,n.keys();case 5:a=e.sent,o=Date.now(),c=r(a),e.prev=8,c.s();case 10:if((i=c.n()).done){e.next=34;break}return u=i.value,e.next=14,n.match(u);case 14:if(!(l=e.sent)){e.next=32;break}return p=l.clone(),e.next=19,p.headers.get("sw-cache-metadata");case 19:if(!(f=e.sent)){e.next=32;break}if(e.prev=21,!((h=JSON.parse(f)).timestamp&&o-h.timestamp>864e5)){e.next=27;break}return console.log("Suppression de l'entrée de cache expirée:",u.url),e.next=27,n.delete(u);case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(21),console.error("Erreur lors de l'analyse des métadonnées de cache:",e.t0);case 32:e.next=10;break;case 34:e.next=39;break;case 36:e.prev=36,e.t1=e.catch(8),c.e(e.t1);case 39:return e.prev=39,c.f(),e.finish(39);case 42:case"end":return e.stop()}}),e,null,[[8,36,39,42],[21,29]])})))).apply(this,arguments)}function v(){return(v=o(t().mark((function e(r,n){var a,o,c,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,caches.open(n.cacheName);case 2:return a=e.sent,e.next=5,a.match(r);case 5:if(!(o=e.sent)){e.next=8;break}return e.abrupt("return",o);case 8:return e.prev=8,e.next=11,fetch(r);case 11:return(c=e.sent).ok&&(s=c.clone(),a.put(r,s)),e.abrupt("return",c);case 16:return e.prev=16,e.t0=e.catch(8),console.error("Erreur réseau pour ressource:",r.url,e.t0),e.abrupt("return",b(r));case 20:case"end":return e.stop()}}),e,null,[[8,16]])})))).apply(this,arguments)}function m(){return(m=o(t().mark((function e(r,n){var a,o,c,s,i,u,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g(r,3e3);case 3:return a=e.sent,e.next=6,caches.open(n.cacheName);case 6:if(o=e.sent,!a.ok){e.next=18;break}return c=a.clone(),(s=new Headers(c.headers)).append("sw-cache-metadata",JSON.stringify({timestamp:Date.now(),url:r.url})),e.t0=Response,e.next=14,c.blob();case 14:e.t1=e.sent,e.t2={status:c.status,statusText:c.statusText,headers:s},i=new e.t0(e.t1,e.t2),o.put(r,i);case 18:return e.abrupt("return",a);case 21:return e.prev=21,e.t3=e.catch(0),console.log("Échec du réseau, fallback vers cache:",r.url),e.next=26,caches.open(n.cacheName);case 26:return u=e.sent,e.next=29,u.match(r);case 29:if(!(l=e.sent)){e.next=32;break}return e.abrupt("return",l);case 32:return e.abrupt("return",b(r));case 33:case"end":return e.stop()}}),e,null,[[0,21]])})))).apply(this,arguments)}function y(){return(y=o(t().mark((function e(r,n){var a,o,c,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,caches.open(n.cacheName);case 2:return a=e.sent,e.next=5,a.match(r);case 5:if(o=e.sent,c=fetch(r).then((function(e){if(e.ok){var t=e.clone(),n=new Headers(t.headers);n.append("sw-cache-metadata",JSON.stringify({timestamp:Date.now(),url:r.url}));var o=new Response(t.body,{status:t.status,statusText:t.statusText,headers:n});a.put(r,o)}return e})).catch((function(e){return console.error("Erreur réseau dans stale-while-revalidate:",e),null})),!o){e.next=9;break}return e.abrupt("return",o);case 9:return e.next=11,c;case 11:if(!(s=e.sent)){e.next=14;break}return e.abrupt("return",s);case 14:return e.abrupt("return",b(r));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){return(x=o(t().mark((function e(r){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g(r,5e3);case 3:return n=e.sent,e.abrupt("return",n);case 7:return e.prev=7,e.t0=e.catch(0),console.log("Échec de navigation, fallback vers page hors ligne",e.t0),e.abrupt("return",caches.match(c));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function g(e,t){return new Promise((function(r,n){var a=setTimeout((function(){n(new Error("Request timeout"))}),t);fetch(e).then((function(e){clearTimeout(a),r(e)}),(function(e){clearTimeout(a),n(e)}))}))}function b(e){var t=new URL(e.url);if("navigate"===e.mode)return caches.match(c);var r=t.pathname.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif","webp","svg"].includes(r)?new Response('<svg xmlns="http://www.w3.org/2000/svg" width="200" height="150" viewBox="0 0 200 150"><rect width="200" height="150" fill="#f5f5f5"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="sans-serif" font-size="14">Image non disponible</text></svg>',{status:503,statusText:"Service Unavailable",headers:{"Content-Type":"image/svg+xml","Cache-Control":"no-store"}}):"json"===r||t.pathname.includes("/wp-json/")||t.pathname.includes("/admin-ajax.php")?new Response(JSON.stringify({error:"Offline",message:"You are currently offline"}),{status:503,statusText:"Service Unavailable",headers:{"Content-Type":"application/json","Cache-Control":"no-store"}}):new Response("",{status:503,statusText:"Service Unavailable",headers:{"Cache-Control":"no-store"}})}self.addEventListener("install",(function(e){e.waitUntil(Promise.all([caches.open(i).then((function(e){return console.log("Service worker installé - Mise en cache des ressources statiques"),e.addAll(h)})),caches.open(s)]).then((function(){return self.skipWaiting()})).catch((function(e){console.error("Erreur lors de la mise en cache des ressources:",e)})))})),self.addEventListener("activate",(function(e){var t=[i,s];e.waitUntil(caches.keys().then((function(e){return Promise.all(e.map((function(e){if(!t.includes(e))return console.log("Suppression de l'ancien cache:",e),caches.delete(e)})))})).then((function(){return self.clients.claim()})).then((function(){return function(){return d.apply(this,arguments)}()})))})),self.addEventListener("fetch",(function(e){if("GET"===e.request.method){var t=function(e){for(var t=0,r=f;t<r.length;t++){var n=r[t];if(n.pattern.test(e.pathname))return n}return{strategy:l,cacheName:i,maxAgeSeconds:86400}}(new URL(e.request.url));switch(t.strategy){case u:e.respondWith(function(e,t){return v.apply(this,arguments)}(e.request,t));break;case l:e.respondWith(function(e,t){return m.apply(this,arguments)}(e.request,t));break;case p:e.respondWith(function(e,t){return y.apply(this,arguments)}(e.request,t));break;default:"navigate"===e.request.mode&&e.respondWith(function(e){return x.apply(this,arguments)}(e.request))}}})),self.addEventListener("message",(function(e){e.data&&"SKIP_WAITING"===e.data.type&&self.skipWaiting()}));var w={MAX_CART_AGE_MS:864e5,SENSITIVE_FIELDS:["card_number","cvv","password","address"],MAX_CART_SIZE_BYTES:102400,MAX_CART_ITEMS:50};function k(e){return _.apply(this,arguments)}function _(){return(_=o(t().mark((function r(n){var a,o,c,s,i,u,l,p;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n&&"object"===e(n)){t.next=4;break}return console.error("Données de panier invalides: format non valide"),t.abrupt("return",null);case 4:if(n.email){t.next=7;break}return console.error("Données de panier invalides: email manquant"),t.abrupt("return",null);case 7:if(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(n.email)){t.next=11;break}return console.error("Données de panier invalides: format d'email incorrect"),t.abrupt("return",null);case 11:if(!n.timestamp){t.next=18;break}if(!(Date.now()-n.timestamp>w.MAX_CART_AGE_MS)){t.next=16;break}return console.error("Données de panier expirées"),t.abrupt("return",null);case 16:t.next=19;break;case 18:n.timestamp=Date.now();case 19:if(a=function(e){return"string"!=typeof e?e:e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")},o=function(t){if(!t||"object"!==e(t))return t;var r=Array.isArray(t)?[]:{};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(w.SENSITIVE_FIELDS.includes(n))continue;var c=t[n];"string"==typeof c?r[n]=a(c):"object"===e(c)&&null!==c?r[n]=o(c):r[n]=c}return r},!(c=o(n)).cart_contents){t.next=38;break}if(!((s=Object.keys(c.cart_contents)).length>w.MAX_CART_ITEMS)){t.next=27;break}return console.error("Données de panier invalides: trop d'articles"),t.abrupt("return",null);case 27:i=0,u=s;case 28:if(!(i<u.length)){t.next=38;break}if(l=u[i],(p=c.cart_contents[l]).product_id&&"number"==typeof p.product_id){t.next=34;break}return console.error("Article de panier invalide: ID de produit manquant ou incorrect"),t.abrupt("return",null);case 34:p.quantity&&(p.quantity=parseInt(p.quantity,10),(isNaN(p.quantity)||p.quantity<=0)&&(p.quantity=1));case 35:i++,t.next=28;break;case 38:if(!(new Blob([JSON.stringify(c)]).size>w.MAX_CART_SIZE_BYTES)){t.next=42;break}return console.error("Données de panier trop volumineuses"),t.abrupt("return",null);case 42:return t.abrupt("return",c);case 45:return t.prev=45,t.t0=t.catch(0),console.error("Erreur lors de la validation des données du panier:",t.t0),t.abrupt("return",null);case 49:case"end":return t.stop()}}),r,null,[[0,45]])})))).apply(this,arguments)}function E(){return(E=o(t().mark((function e(){var r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,localforage.getItem("abandoned_cart");case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return");case 6:if(!r.timestamp){e.next=14;break}if(!(Date.now()-r.timestamp>w.MAX_CART_AGE_MS)){e.next=14;break}return e.next=11,localforage.removeItem("abandoned_cart");case 11:return e.next=13,localforage.removeItem("cart_nonce");case 13:console.log("Données de panier expirées supprimées");case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.error("Erreur lors du nettoyage des données expirées:",e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})))).apply(this,arguments)}function S(){return(S=o(t().mark((function e(){var r,n,a,o,c,s,i,u,l,p,f,h;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,localforage.getItem("abandoned_cart");case 3:return r=e.sent,e.next=6,localforage.getItem("cart_nonce");case 6:if(n=e.sent,r){e.next=10;break}return console.log("Aucun panier à synchroniser"),e.abrupt("return");case 10:return e.next=12,k(r);case 12:if(a=e.sent){e.next=18;break}return console.error("Impossible de synchroniser: données de panier invalides"),e.next=17,localforage.removeItem("abandoned_cart");case 17:return e.abrupt("return",!1);case 18:if(n){e.next=21;break}return console.error("Impossible de synchroniser: nonce de sécurité manquant"),e.abrupt("return",!1);case 21:o={"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},c="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),s=new URLSearchParams({action:"life_travel_sync_abandoned_cart",cart_data:JSON.stringify(a),security:n,request_id:c,client_timestamp:Date.now().toString()}),i=3,u=null,l=t().mark((function e(){var r,n,a,l,p,h;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g("/wp-admin/admin-ajax.php",{method:"POST",headers:o,body:s,credentials:"same-origin"});case 3:return r=e.sent,e.next=6,r.json();case 6:if(n=e.sent,!r.ok||!n.success){e.next=20;break}return e.next=10,localforage.removeItem("abandoned_cart");case 10:return e.next=12,localforage.removeItem("cart_nonce");case 12:return console.log("Panier abandonné synchronisé avec succès, identifiant:",n.cart_id||"non spécifié"),e.next=15,self.clients.matchAll();case 15:return e.sent.forEach((function(e){e.postMessage({type:"CART_SYNCED",timestamp:Date.now(),requestId:c,cartId:n.cart_id||null})})),e.abrupt("return",{v:!0});case 20:throw a=n.error&&"string"==typeof n.error?n.error:"Réponse de serveur invalide",new Error(a);case 22:e.next=34;break;case 24:if(e.prev=24,e.t0=e.catch(0),u=e.t0,l=Math.min(8e3,1e3*Math.pow(2,f)),p=.3*Math.random()*l,h=Math.floor(l+p),console.error("Tentative ".concat(f+1,"/").concat(i," échouée, nouvelle tentative dans ").concat(h,"ms"),e.t0),!(f<i-1)){e.next=34;break}return e.next=34,new Promise((function(e){return setTimeout(e,h)}));case 34:case"end":return e.stop()}}),e,null,[[0,24]])})),f=0;case 30:if(!(f<i)){e.next=38;break}return e.delegateYield(l(),"t0",32);case 32:if(!(p=e.t0)){e.next=35;break}return e.abrupt("return",p.v);case 35:f++,e.next=30;break;case 38:if(console.error("Échec de synchronisation après plusieurs tentatives:",u),h=Date.now(),!(a.timestamp&&h-a.timestamp<=w.MAX_CART_AGE_MS)){e.next=45;break}return console.log("Les données du panier seront conservées pour une synchronisation ultérieure"),e.abrupt("return",!1);case 45:return e.next=47,localforage.removeItem("abandoned_cart");case 47:return e.next=49,localforage.removeItem("cart_nonce");case 49:return console.log("Données de panier expirées supprimées après échec de synchronisation"),e.abrupt("return",!1);case 51:e.next=57;break;case 53:return e.prev=53,e.t1=e.catch(0),console.error("Erreur critique lors de la synchronisation du panier:",e.t1),e.abrupt("return",!1);case 57:case"end":return e.stop()}}),e,null,[[0,53]])})))).apply(this,arguments)}self.addEventListener("sync",(function(e){"sync-cart"===e.tag?e.waitUntil(function(){return S.apply(this,arguments)}()):"clean-expired-cart-data"===e.tag&&e.waitUntil(function(){return E.apply(this,arguments)}())}))})();